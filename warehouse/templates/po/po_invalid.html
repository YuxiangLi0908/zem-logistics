{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}

<div style="max-height: 100%; max-width: 100%;">
    <div><b>PO失效</b></div>
</div>
{% load static custom_filters %}
    <form method="post" style="width: 100%;">
        {% csrf_token %}
        <div class="container mt-3" style="max-width: 100%;">
            <div style="overflow-x: auto; max-width: 100%; overflow-y: auto; max-height: 800px;">
                <table class="table" style="font-size: 11px">
                    <thead>
                        <tr>
                            <th class="th" style="max-width: 5%; min-width: 10px; text-align: center;">确认通知</th>
                            <th>柜号</th>
                            <th>packing_list</th>
                            <th>是否通知客户</th>
                            <th>操作指令</th>
                        </tr>
                        <tr style="position: sticky; top: 28px;">
                            <th class="th" style="max-width: 5%; min-width: 10px; text-align: center;">
                                <input type="checkbox" id="selectAllCheckbox" onchange="toggleAllCheckboxes()">
                            </th>
                            <th class="th">
                                <input type="text" id="ctnSearch" placeholder="搜索柜号..." oninput="filterTable(this, 1, true)" size="13" style="font-size: 11px;">
                            </th>
                            <th class="th">
                                <input type="text" id="ctnSearch" placeholder="搜索pl..." oninput="filterTable(this, 1, true)" size="13" style="font-size: 11px;">
                            </th>
                            <th class="th"></th>
                            <th class="th"></th>
                        </tr>
                    </thead>
                    <tbody id="palletization-container">                       
                        {% for po in po_check %}
                        <tr id="palletization-row">
                            <td class="td" style="max-width: 5%; min-width: 10px; text-align: center;">
                                <input type='checkbox' name='is_selected' onclick="toggleRowBackground(this)">
                                <input type="hidden" name="is_selected", value='off'>
                                <input type="hidden" name="po_ids", value='{{ po.id }}'>
                            </td>
                            <td class="td">{{ po.container_number }}</td>
                            <td class="td">{{ po.packing_list.shipping_mark }}</td>
                            <td>
                                <div id="notification-toggle" style="display: flex; align-items: center; cursor: pointer;">
                                    <span id="notification-status" style="font-weight: bold; margin-right: 10px; margin-right:10px;">
                                        {% if po.is_notified %}
                                            已通知
                                        {% else %}
                                            未通知
                                        {% endif %}
                                    </span>
                                </div>
                            </td>                         
                            <td class="td"><input type="text"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <input type="hidden" name="step" value="po_invalid_save">
        <button type="submit" onclick="confirmSubmit" class="btn btn-primary" style="width: 100px; height: 35px;">保存</button>
    </form>

<script>
    
    function toggleNotification() {
        const checkbox = document.getElementById('notify-checkbox');
        const statusText = document.getElementById('notification-status');
        checkbox.checked ? statusText.textContent = '已通知' : statusText.textContent = '未通知';
    };
      
    function confirmSubmit() {
        const checkBoxes = document.getElementsByName('is_selected');
        for (let i = 0; i < checkBoxes.length; i+=2) {
            if (checkBoxes[i].checked) {
                checkBoxes[i+1].disabled = true;
            }
        }
    };
    function toggleAllCheckboxes() {
        var selectAllCheckbox = document.getElementById('selectAllCheckbox');
        var checkboxes = document.querySelectorAll('tbody input[type="checkbox"][name="is_selected"]');
        
        checkboxes.forEach(function(checkbox) {
            var tr = checkbox.closest('tr');
            if (tr.style.display !== 'none') {
                checkbox.checked = selectAllCheckbox.checked;
                if (checkbox.checked) {
                    tr.style.backgroundColor = '#ADD8E6'; // Change to your desired color
                } else {
                    tr.style.backgroundColor = ''; // Reset to default color
                }
            }
        });
    };

    function toggleRowBackground(checkbox) {
        var row = checkbox.closest('tr');
        if (checkbox.checked) {
            row.style.backgroundColor = '#ADD8E6'; 
        } else {
            row.style.backgroundColor = ''; 
        }
    };
    
</script>
{% endblock %}
