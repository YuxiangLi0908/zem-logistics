
{% extends 'base.html' %}

{% block content %}
<div><h4><b>财务订单确认——总计 $<span class="total_amount">{{ total_amount }}</span></b></h4></div>
<div  style="display: inline-block; width: 100%; margin: 0; padding: 0; max-width: 100%;">   
    <form method="post" action="" style="display: flex; justify-content: space-between;">
        {% csrf_token %}
        <p style="text-align:center; margin:0 auto;"><b>{{ invoice }}</b></p>
        <input type="hidden" name="start_date_confirm" value="{{ start_date_confirm }}">
        <input type="hidden" name="end_date_confirm" value="{{ end_date_confirm }}">
        <input type="hidden" name="step" value="confirm_save">
        <input type="hidden" name="invoice_type" value="{{ invoice_type }}">
        <input type="hidden" name="container_number" value="{{ container_number }}">
        <button id="editButton" type="submit" class="btn btn-primary" onclick="AmountForm()" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:80px;">账单确认</button>  
    </form>
<div>
{% if order_type != "直送" %}
<div style="display: flex; max-height: 720px;">
    <div style="overflow-y: auto; max-height: 100%; width: 40%; border: 2px solid rgb(180, 180, 180); border-radius: 12px; padding: 1%; margin: 1%;">
        <div style="margin-left: auto; display: inline-flex; align-items: center; padding: 0 12px; background: #f8f9fa; border-radius: 4px; border: 1px solid #e0e0e0;">
            <span style="font-weight: bold; color: #555; margin-right: 5px;">提拆柜费用总计：</span>
            <span id="total_amount" style="font-weight: bold; color: #2c3e50;">{{ invoice_preports.amount }}</span>
            <span style="font-weight: bold; color: #2c3e50; margin-left: 3px;">USD</span>
        </div>
        <form method="post" action="">
            {% csrf_token %}
            <input type="hidden" name="step" id="preport_step" value="">
            <input type="hidden" name="status" value="preport">
            <input type="hidden" name="start_date_confirm" value="{{ start_date_confirm }}">
            <input type="hidden" name="end_date_confirm" value="{{ end_date_confirm }}">
            <input type="hidden" name="container_number" value="{{ container_number }}">
            <input type="hidden" name="invoice_type" value="{{ invoice_type }}">
            <input type="text" placeholder="驳回原因" name="reject_reason" style="width:100px;" value ="{{ reject_reason|default_if_none:'' }}">
            <button id="editButton" type="submit" class="btn btn-danger" onclick="PreportStep('dismiss')" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:80px;">驳回</button>  
            <button id="editButton" type="submit" class="btn btn-danger" onclick="PreportStep('redirect')" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:10px;">编辑账单</button> 
        </form>
        <div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 100px; font-weight: color:#483D8B;" >费用名称</label>
                <span style="color:#483D8B;">价格</span>
                <span style="margin: 0 5px;"></span>
                <span style="margin-left:60px; color:#483D8B;">附加费</span>
                <span style="margin-left:35px; color:#483D8B;">附加费说明</span>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="pickup">提拆/打托缠膜:</label>
                <input type="number" class="original-input" style="width: 70px;" id="pickup" name="pickup" value="{{ invoice_preports.pickup }}" disabled>                
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="chassis">托架费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="chassis" name="chassis" value="{{ invoice_preports.chassis }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="chassis_surcharge" name="chassis_surcharge" value="{{ invoice_preports.surcharges.chassis }}" disabled>
                <input type="text" style="width: 70px;" id="chassis_surcharge_note" name="chassis_surcharge_note" value="{{ invoice_preports.surcharge_notes.chassis }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="chassis_split">托架提取费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="chassis_split" name="chassis_split" value="{{ invoice_preports.chassis_split }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="chassis_split_surcharge" name="chassis_split_surcharge" value="{{ invoice_preports.surcharges.chassis_split }}" disabled>
                <input type="text" style="width: 70px;" id="chassis_split_surcharge_note" name="chassis_split_surcharge_note" value="{{ invoice_preports.surcharge_notes.chassis_split }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="prepull">预提费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="prepull" name="prepull" value="{{ invoice_preports.prepull }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="prepull_surcharge" name="prepull_surcharge" value="{{ invoice_preports.surcharges.prepull }}" disabled>
                <input type="text" style="width: 70px;" id="prepull_surcharge_note" name="prepull_surcharge_note" value="{{ invoice_preports.surcharge_notes.prepull }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="yard_storage">货柜放置费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="yard_storage" name="yard_storage" value="{{ invoice_preports.yard_storage }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="yard_storage_surcharge" name="yard_storage_surcharge" value="{{ invoice_preports.surcharges.yard_storage }}" disabled>
                <input type="text" style="width: 70px;" id="yard_storage_surcharge_note" name="yard_storage_surcharge_note" value="{{ invoice_preports.surcharge_notes.yard_storage }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="handling_fee">操作处理费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="handling_fee" name="handling_fee" value="{{ invoice_preports.handling_fee }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="handling_fee_surcharge" name="handling_fee_surcharge" value="{{ invoice_preports.surcharges.handling_fee }}" disabled>
                <input type="text" style="width: 70px;" id="handling_fee_surcharge_note" name="handling_fee_surcharge_note" value="{{ invoice_preports.surcharge_notes.handling_fee }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="pier_pass">码头</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="pier_pass" name="pier_pass" value="{{ invoice_preports.pier_pass }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="pier_pass_surcharge" name="pier_pass_surcharge" value="{{ invoice_preports.surcharges.pier_pass }}" disabled>
                <input type="text" style="width: 70px;" id="pier_pass_surcharge_note" name="pier_pass_surcharge_note" value="{{ invoice_preports.surcharge_notes.pier_pass }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="congestion_fee">港口拥堵费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="congestion_fee" name="congestion_fee" value="{{ invoice_preports.congestion_fee }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="congestion_fee_surcharge" name="congestion_fee_surcharge" value="{{ invoice_preports.surcharges.congestion_fee }}" disabled>
                <input type="text" style="width: 70px;" id="congestion_fee_surcharge_note" name="congestion_fee_surcharge_note" value="{{ invoice_preports.surcharge_notes.congestion_fee }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="hanging_crane">吊柜费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="hanging_crane" name="hanging_crane" value="{{ invoice_preports.hanging_crane }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="hanging_crane_surcharge" name="hanging_crane_surcharge" value="{{ invoice_preports.surcharges.hanging_crane }}" disabled>
                <input type="text" style="width: 70px;" id="hanging_crane_surcharge_note" name="hanging_crane_surcharge_note" value="{{ invoice_preports.surcharge_notes.hanging_crane }}" disabled>
            </div>           
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="dry_run">空跑费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="dry_run" name="dry_run" value="{{ invoice_preports.dry_run }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="dry_run_surcharge" name="dry_run_surcharge" value="{{ invoice_preports.surcharges.dry_run }}" disabled>
                <input type="text" style="width: 70px;" id="dry_run_surcharge_note" name="dry_run_surcharge_note" value="{{ invoice_preports.surcharge_notes.dry_run }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="exam_fee">查验费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="exam_fee" name="exam_fee" value="{{ invoice_preports.exam_fee }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="exam_fee_surcharge" name="exam_fee_surcharge" value="{{ invoice_preports.surcharges.exam_fee }}" disabled>
                <input type="text" style="width: 70px;" id="exam_fee_surcharge_note" name="exam_fee_surcharge_note" value="{{ invoice_preports.surcharge_notes.exam_fee }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="hazmat">危险品</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="hazmat" name="hazmat" value="{{ invoice_preports.hazmat }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="hazmat_surcharge" name="hazmat_surcharge" value="{{ invoice_preports.surcharges.hazmat }}" disabled>
                <input type="text" style="width: 70px;" id="hazmat_surcharge_note" name="hazmat_surcharge_note" value="{{ invoice_preports.surcharge_notes.hazmat }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="over_weight">超重费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="over_weight" name="over_weight" value="{{ invoice_preports.over_weight }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="over_weight_surcharge" name="over_weight_surcharge" value="{{ invoice_preports.surcharges.over_weight }}" disabled>
                <input type="text" style="width: 70px;" id="over_weight_surcharge_note" name="over_weight_surcharge_note" value="{{ invoice_preports.surcharge_notes.over_weight }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="urgent_fee">加急费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="urgent_fee" name="urgent_fee" value="{{ invoice_preports.urgent_fee }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="urgent_fee_surcharge" name="urgent_fee_surcharge" value="{{ invoice_preports.surcharges.urgent_fee }}" disabled>
                <input type="text" style="width: 70px;" id="urgent_fee_surcharge_note" name="urgent_fee_surcharge_note" value="{{ invoice_preports.surcharge_notes.urgent_fee }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="other_serive">其他服务</label>
                <input type="number" class="original-input" step="0.01" style="width: 70px; margin-right: 10px;" id="other_serive" name="other_serive" value="{{ invoice_preports.other_serive }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="other_serive_surcharge" name="other_serive_surcharge" value="{{ invoice_preports.surcharges.other_serive }}" disabled>
                <input type="text" style="width: 70px;" id="other_serive_surcharge_note" name="other_serive_surcharge_note" value="{{ invoice_preports.surcharge_notes.other_serive }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="demurrage">港内滞期费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="demurrage" name="demurrage" value="{{ invoice_preports.demurrage }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="demurrage_surcharge" name="demurrage_surcharge" value="{{ invoice_preports.surcharges.demurrage }}" disabled>
                <input type="text" style="width: 70px;" id="demurrage_surcharge_note" name="demurrage_surcharge_note" value="{{ invoice_preports.surcharge_notes.demurrage }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="per_diem">港外滞期费</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="per_diem" name="per_diem" value="{{ invoice_preports.per_diem }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="per_diem_surcharge" name="per_diem_surcharge" value="{{ invoice_preports.surcharges.per_diem }}" disabled>
                <input type="text" style="width: 70px;" id="per_diem_surcharge_note" name="per_diem_surcharge_note" value="{{ invoice_preports.surcharge_notes.per_diem }}" disabled>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;" for="second_pickup">二次提货</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="second_pickup" name="second_pickup" value="{{ invoice_preports.second_pickup }}" disabled>
                <span style="margin: 0 5px;">+</span>
                <input type="number" style="width: 70px; margin-right: 10px;" id="second_pickup_surcharge" name="second_pickup_surcharge" value="{{ invoice_preports.surcharges.second_pickup }}" disabled>
                <input type="text" style="width: 70px;" id="second_pickup_surcharge_note" name="second_pickup_serive_surcharge_note" value="{{ invoice_preports.surcharge_notes.second_pickup }}" disabled>
            </div>
            {% for key,value in invoice_preports.other_fees.items %}
            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <label style="width: 120px; font-weight: bold;">{{ key }}</label>
                <input type="number" class="original-input" style="width: 70px; margin-right: 10px;"  value="{{ value }}" disabled>
            </div>
            {% endfor %}
            
        </div>
    </div>
    <div style="display: flex; gap: 1%; max-height: 1000px;">
        {% for invoice_warehouse in invoice_warehouses %}
        <div style="flex: 1; min-width: 30%; max-height: 100%; border: 2px solid #b4b4b4; 
           border-radius: 12px; padding: 1%; margin: 0.5%; 
           overflow-y: auto">
            <div style="margin-left: auto; display: inline-flex; align-items: center; padding: 0 12px; background: #f8f9fa; border-radius: 4px; border: 1px solid #e0e0e0;">
                {% if invoice_warehouse.delivery_type == 'public' %}公仓{% else %}私仓{% endif %}
                <span style="font-weight: bold; color: #555; margin-right: 5px;">库内费用总计：</span>
                <span id="total_amount" style="font-weight: bold; color: #2c3e50;">{{ invoice_warehouse.amount }}</span>
                <span style="font-weight: bold; color: #2c3e50; margin-left: 3px;">USD</span>
            </div>
            <form method="post" action="">
                {% csrf_token %}
                <input type="hidden" name="step" class="warehouse_step" value="">
                <input type="hidden" name="status" value="warehouse">
                <input type="hidden" name="delivery_type" value="{{ invoice_warehouse.delivery_type }}">
                <input type="hidden" name="start_date_confirm" value="{{ start_date_confirm }}">
                <input type="hidden" name="end_date_confirm" value="{{ end_date_confirm }}">
                <input type="hidden" name="container_number" value="{{ container_number }}">
                <input type="hidden" name="invoice_type" value="{{ invoice_type }}">
                <input type="text" placeholder="驳回原因" style="width:100px;" name="reject_reason" value ="{{ reject_reason|default_if_none:'' }}">
                <button id="editButton" type="submit" class="btn btn-danger" onclick="WarehouseStep('dismiss',this.form)" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:30px;">驳回</button>  
                <button id="editButton" type="submit" class="btn btn-danger" onclick="WarehouseStep('redirect',this.form)" style="background-color:green; font-size: 13px; padding:10px 20px;">编辑账单</button> 
            </form>
            <div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 100px; font-weight: color:#483D8B;" >费用名称</label>
                    <span style="color:#483D8B;">价格</span>
                    <span style="margin: 0 5px;"></span>
                    <span style="margin-left:60px; color:#483D8B;">附加费</span>
                    <span style="margin-left:35px; color:#483D8B;">附加费说明</span>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="sorting">分拣费</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="sorting" name="sorting" value="{{ invoice_warehouse.sorting }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="sorting_surcharge" name="sorting_surcharge" value="{{ invoice_warehouse.surcharges.sorting }}" disabled>
                    <input type="text" style="width: 70px;" id="sorting_surcharge_note" name="sorting_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.sorting }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="intercept">拦截费</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="intercept" name="intercept" value="{{ invoice_warehouse.intercept }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="intercept_surcharge" name="intercept_surcharge" value="{{ invoice_warehouse.surcharges.intercept }}" disabled>
                    <input type="text" style="width: 70px;" id="intercept_surcharge_note" name="intercept_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.intercept }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="self_pickup">客户自提</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="self_pickup" name="self_pickup" value="{{ invoice_warehouse.self_pickup }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="self_pickup_surcharge" name="intercept_surcharge" value="{{ invoice_warehouse.surcharges.self_pickup }}" disabled>
                    <input type="text" style="width: 70px;" id="self_pickup_surcharge_note" name="self_pickup_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.self_pickup }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="re_pallet">重新打板</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="re_pallet" name="re_pallet" value="{{ invoice_warehouse.re_pallet }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="re_pallet_surcharge" name="re_pallet_surcharge" value="{{ invoice_warehouse.surcharges.re_pallet }}" disabled>
                    <input type="text" style="width: 70px;" id="re_pallet_surcharge_note" name="re_pallet_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.re_pallet }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="counting">货品清点费</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="counting" name="counting" value="{{ invoice_warehouse.counting }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="counting_surcharge" name="counting_surcharge" value="{{ invoice_warehouse.surcharges.counting }}" disabled>
                    <input type="text" style="width: 70px;" id="counting_surcharge_note" name="counting_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.counting }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="warehouse_rent">仓租</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="warehouse_rent" name="warehouse_rent" value="{{ invoice_warehouse.warehouse_rent }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="warehouse_rent_surcharge" name="warehouse_rent_surcharge" value="{{ invoice_warehouse.surcharges.warehouse_rent }}" disabled>
                    <input type="text" style="width: 70px;" id="warehouse_rent_surcharge_note" name="warehouse_rent_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.warehouse_rent }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="specified_labeling">指定贴标</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="specified_labeling" name="specified_labeling" value="{{ invoice_warehouse.specified_labeling }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="specified_labeling_surcharge" name="specified_labeling_surcharge" value="{{ invoice_warehouse.surcharges.specified_labeling }}" disabled>
                    <input type="text" style="width: 70px;" id="specified_labeling_surcharge_note" name="warehouse_rent_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.specified_labeling }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="inner_outer_box">内外箱</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="inner_outer_box" name="inner_outer_box" value="{{ invoice_warehouse.inner_outer_box }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="inner_outer_box_surcharge" name="inner_outer_box_surcharge" value="{{ invoice_warehouse.surcharges.inner_outer_box }}" disabled>
                    <input type="text" style="width: 70px;" id="inner_outer_box_surcharge_note" name="inner_outer_box_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.inner_outer_box }}" disabled>
                </div>
                
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="pallet_label">托盘标签</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="pallet_label" name="pallet_label" value="{{ invoice_warehouse.pallet_label }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="pallet_label_surcharge" name="pallet_label_surcharge" value="{{ invoice_warehouse.surcharges.pallet_label }}" disabled>
                    <input type="text" style="width: 70px;" id="pallet_label_surcharge_note" name="pallet_label_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.pallet_label }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="open_close_box">开封箱</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="open_close_box" name="open_close_box" value="{{ invoice_warehouse.open_close_box }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="open_close_box_surcharge" name="open_close_box_surcharge" value="{{ invoice_warehouse.surcharges.open_close_box }}" disabled>
                    <input type="text" style="width: 70px;" id="open_close_box_surcharge_note" name="open_close_box_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.open_close_box }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="destroy">销毁</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="destroy" name="destroy" value="{{ invoice_warehouse.destroy }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="destroy_surcharge" name="destroy_surcharge" value="{{ invoice_warehouse.surcharges.destroy }}" disabled>
                    <input type="text" style="width: 70px;" id="destroy_surcharge_note" name="destroy_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.destroy }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="take_photo">拍照</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="take_photo" name="take_photo" value="{{ invoice_warehouse.take_photo }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="take_photo_surcharge" name="take_photo_surcharge" value="{{ invoice_warehouse.surcharges.take_photo }}" disabled>
                    <input type="text" style="width: 70px;" id="take_photo_surcharge_note" name="take_photo_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.take_photo }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="take_video">拍视频</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="take_video" name="take_video" value="{{ invoice_warehouse.take_video }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="take_video_surcharge" name="take_photo_surcharge" value="{{ invoice_warehouse.surcharges.take_video }}" disabled>
                    <input type="text" style="width: 70px;" id="take_video_surcharge_note" name="take_video_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.take_video }}" disabled>
                </div>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;" for="repeated_operation_fee">重复操作费</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;" id="repeated_operation_fee" name="repeated_operation_fee" value="{{ invoice_warehouse.repeated_operation_fee }}" disabled>
                    <span style="margin: 0 5px;">+</span>
                    <input type="number" style="width: 70px; margin-right: 10px;" id="repeated_operation_fee_surcharge" name="repeated_operation_fee_surcharge" value="{{ invoice_warehouse.surcharges.repeated_operation_fee }}" disabled>
                    <input type="text" style="width: 70px;" id="repeated_operation_fee_surcharge_note" name="repeated_operation_fee_surcharge_note" value="{{ invoice_warehouse.surcharge_notes.repeated_operation_fee }}" disabled>
                </div>
                {% for key,value in invoice_warehouse.other_fees.items %}
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <label style="width: 120px; font-weight: bold;">{{ key }}</label>
                    <input type="number" class="original-input" style="width: 70px; margin-right: 10px;"  value="{{ value }}" disabled>
                </div>
                {% endfor %}              
            </div>
        </div>
        {% endfor %}
    </div>
    <div style="overflow-y: auto; max-height: 100%; width: 50%; border: 2px solid rgb(180, 180, 180); border-radius: 12px; padding: 1%; margin: 1%;">
        <div style="margin-left: auto; display: inline-flex; align-items: center; padding: 0 12px; background: #f8f9fa; border-radius: 4px; border: 1px solid #e0e0e0;">
            <span style="font-weight: bold; color: #555; margin-right: 5px;">派送费用总计：</span>
            <span id="total_amount" style="font-weight: bold; color: #2c3e50;">{{ delivery_amount }}</span>
            <span style="font-weight: bold; color: #2c3e50; margin-left: 3px;">USD</span>
        </div>
        <form method="post" action="">
            {% csrf_token %}
            <input type="hidden" name="step" id="delivery_step" value="">
            <input type="hidden" name="status" value="delivery">
            <input type="hidden" name="start_date_confirm" value="{{ start_date_confirm }}">
            <input type="hidden" name="end_date_confirm" value="{{ end_date_confirm }}">
            <input type="hidden" name="container_number" value="{{ container_number }}">
            <input type="hidden" name="invoice_type" value="{{ invoice_type }}">
            <input type="text" placeholder="驳回原因" name="reject_reason" value ="{{ reject_reason|default_if_none:'' }}">
            <select name="reject_type" class="form-control" style="width:150px;">
                <option value="">驳回类型</option>
                <option value="self">私仓</option>
                <option value="public">公仓</option>
            </select>
            <button id="editButton" type="submit" class="btn btn-danger" onclick="DeliveryStep('dismiss')" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:50px;">驳回</button>  
            <button id="editButton" type="submit" class="btn btn-danger" onclick="DeliveryStep('redirect')" style="background-color:green; font-size: 13px; padding:10px 20px; margin-right:80px;">编辑账单</button>  
        </form>
        {% if amazon %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>亚马逊派送——<label id="amazon_amount"></label></b>
            <table class="table" id="amazon-table" style="font-size: 13px">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:70px;">激活</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in amazon %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" style = "width:70px;" id="amazon_cost" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:50px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="number" style = "width:60px;" name="po_activation" value="{{ plt.po_activation }}" disabled></td>
                        <td class="td"><input type="text" style = "width:80px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% if walmart %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>沃尔玛派送——<label id="walmart_amount"></label></b>
            <table class="table" id="walmart-table" style="font-size: 13px">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:70px;">激活</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in walmart %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td"> 
                            <input type="number" style = "width:70px;" id="walmart_cost" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:50px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="number" style = "width:60px;" name="po_activation" value="{{ plt.po_activation }}" disabled></td>
                        <td class="td"><input type="text" style = "width:80px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% if local %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>本地派送——<label id="local_amount">0</label></b>
            <table class="table" id="local-table" style="font-size: 13px;">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:70px;">激活</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                        <th class="th" style = "width:70px;">邮编</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in local %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" id="local_cost" style = "width:70px;" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:50px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="number" style = "width:60px;" name="po_activation" value="{{ plt.po_activation }}" disabled></td>
                        <td class="td"><input type="text" style = "width:80px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="zipcode" step = 0.01 value="{{ plt.zipcode|floatformat:2 }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% if combine %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>组合柜派送——<label id="combine_amount">0</label></b>
            <table class="table" id="combine-table" style="font-size: 13px;">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:70px;">激活</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in combine %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" id="combine_cost" style = "width:70px;" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:50px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="number" style = "width:60px;" name="po_activation" value="{{ plt.po_activation }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div> 
        {% endif %}  
        {% if selfdelivery %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>自发——<label id="selfdelivery_amount"></label></b>
            <table class="table" id="selfdelivery-table" style="font-size: 13px;">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                        <th class="th" style = "width:70px;">备注</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in selfdelivery %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" id="selfdelivery_cost" style = "width:70px;" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:70px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="note"  value="{{ plt.note|default:'' }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div> 
        {% endif %}
        {% if upsdelivery %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>UPS——<label id="upsdelivery_amount"></label></b>
            <table class="table" id="upsdelivery-table" style="font-size: 13px;">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                        <th class="th" style = "width:70px;">备注</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in upsdelivery %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" id="upsdelivery_cost" style = "width:70px;" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:70px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="note"  value="{{ plt.note|default:'' }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div> 
        {% endif %}
        {% if selfpickup %}
        <div style="border-bottom: 1px solid #ccc; margin-top: 5px;padding-bottom: 5px;text-align:center">
            <b>客户自提——<label id="selfpickup_amount"></label></b>
            <table class="table" id="selfpickup-table" style="font-size: 13px;">
                <thead>
                    <tr style="position: sticky; top: 0;">
                        <th class="th" style = "width:70px;">总价</th>
                        <th class="th" style = "width:70px;">板数</th>
                        <th class="th" style = "width:80px;">目的地</th>
                        <th class="th" style = "width:70px;">CBM</th>
                        <th class="th" style = "width:70px;">重量</th>
                        <th class="th" style = "width:70px;">备注</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plt in selfpickup %}
                    <tr draggable="true" id="pallet-{{ plt.id }}">
                        <td class="td">
                            <input type="number" id="selfpickup_cost" style = "width:70px;" name="cost" value="{{ plt.total_cost }}" disabled>
                        </td>
                        <td class="td"><input type="number" style = "width:70px;" name="total_pallet" value="{{ plt.total_pallet }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="destination" value="{{ plt.destination }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="cbm" step = 0.01 value="{{ plt.total_cbm|floatformat:2 }}" disabled></td>
                        <td class="td"><input type="number" style = "width:70px;" name="weight_lbs" step = 0.01 value="{{ plt.total_weight_lbs }}" disabled></td>
                        <td class="td"><input type="text" style = "width:70px;" name="note"  value="{{ plt.note|default:'' }}" disabled></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
<div>
{% endif %}

<script>
    
    function PreportStep(value){
        const StepInput = document.getElementById('preport_step');
        StepInput.value = value;
    };
    function WarehouseStep(value,form){
        const StepInput = form.querySelector('.warehouse_step');
        if (StepInput) {
            StepInput.value = value;
            console.log('value',value);
        }      
        console.log(StepInput);
    };
    function DeliveryStep(value){
        const StepInput = document.getElementById('delivery_step');
        StepInput.value = value;
    };
    function DirectStep(value){
        const StepInput = document.getElementById('direct_step');
        StepInput.value = value;
    };
    document.addEventListener('DOMContentLoaded', function() {
        initializeAmounts();
        calculateAllTotals();
    });

    function initializeAmounts() {
        const amountIds = [
          'amazon_amount',
          'walmart_amount',
          'combine_amount',
          'local_amount',
          "selfdelivery_amount",
          "upsdelivery_amount",
          "selfpickup_amount",
        ];
      
        amountIds.forEach(amountId => {
            const prefix = amountId.replace(/_amount$/, '').replace(/_cost$/, '');
            const costElements = document.querySelectorAll(`[id$="${prefix}_cost"]`);
            
            let totalCost = 0;
            costElements.forEach(element => {
              const value = parseFloat(element.value) || 0;
              totalCost += value;
            });
        
            const amountElement = document.getElementById(amountId);
            if (amountElement) {
              amountElement.textContent = totalCost.toFixed(2); 
            }
          });
    }

</script>

{% endblock%}