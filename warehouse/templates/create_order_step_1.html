{% extends 'base.html' %}

{% block content %}
    <div class="container mt-5">
        <h2 class="mb-4">Create a New Order</h2>

        <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            <div class="row">
                <div class="col-md-6">
                    <!-- {% for field in customer_form %}
                        {% if field.label != "customer_name" %}
                            <div class="form-group">
                                <label class="col-form-label">{{ field.label }}</label>
                                {{ field }}
                            </div>
                        {% endif %}
                    {% endfor %} -->

                    {% for field in container_form %}
                        <div class="form-group">
                            <label class="col-form-label">{{ field.label }}</label>
                            {{ field }}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- {{ order_form.management_form }}
            <div id="formsets-container">
                {% for of in order_form.forms %}
                    <div class="formset-row">
                        <div class="row">
                            <div class="col-md-6">
                                {{ of.as_table }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div> -->

            {{ packing_list_form.management_form }}
            <div id="formsets-container">
                {% for pl in packing_list_form.forms %}
                    <div class="formset-row">
                        <div class="row">
                            {{ pl.as_table }}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <button type="button" id="add-more-btn" class="btn btn-success">Add More</button>
            <button type="submit" class="btn btn-primary">Submit</button>
            
        </form>

    </div>

    <script>
        // Add Bootstrap validation styles
        (function () {
            'use strict';

            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');

                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>

    <!-- Button to trigger the modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
        Open Modal
    </button>

    <!-- Modal -->
    <div class="modal" id="myModal">
        <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
            <h4 class="modal-title">Modal Title</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
            <!-- Content for the modal goes here -->
            <p>This is some modal content.</p>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!-- Save button -->
            <button type="button" class="btn btn-primary" id="saveButton">Save</button>
            </div>

        </div>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js" integrity="sha384-P8HR+EjhI6LKcmPhZGtFuWm4s8o8QI6pL47rytP88SS7VOLvEZkYpB/QCyIgsA" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8sh+WyL/JWu8f1B8Ehq82vQpsTl2aDmYD5I6S" crossorigin="anonymous"></script>

    <!-- Your custom JavaScript code -->
    <script>
        // Add your custom JavaScript here
        document.getElementById('saveButton').addEventListener('click', function () {
        // Add logic to save data to models (to be implemented later)
        // ...
        // Close the modal
        $('#myModal').modal('hide');
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const formsetsContainer = document.getElementById('formsets-container');
            const addMoreBtn = document.getElementById('add-more-btn');
            
            addMoreBtn.addEventListener('click', function () {
                const newFormset = document.createElement('div');
                const formsetCount = document.getElementsByClassName('formset-row').length;
                newFormset.className = 'formset-row';
                newFormset.setAttribute('id', `id_order-${formsetCount}-container_id`)
                // Clone the first formset and update the form indexes
                const firstFormset = formsetsContainer.querySelector('.formset-row');
                const newFormsetHtml = firstFormset.innerHTML.replace(/__prefix__/g, formsetCount);

                newFormset.innerHTML = newFormsetHtml;
                formsetsContainer.appendChild(newFormset);
                for (let i = 0; i < newFormset.getElementsByTagName('input').length; i++) {
                    const inputField = newFormset.getElementsByTagName('input')[i]
                    inputField.id = inputField.id.replace('-0-', `-${formsetCount}-`)
                    inputField.name = inputField.name.replace('-0-', `-${formsetCount}-`)
                }

                // const containerInput = newFormset.getElementsByTagName('input')[0]
                // const etaInput = newFormset.getElementsByTagName('input')[1]
                // containerInput.id = containerInput.id.replace('-0-', `-${formsetCount}-`)
                // etaInput.id = etaInput.id.replace('-0-', `-${formsetCount}-`)
                // containerInput.name = containerInput.name.replace('-0-', `-${formsetCount}-`)
                // etaInput.name = etaInput.name.replace('-0-', `-${formsetCount}-`)

                // Increment the form count
                document.getElementById('id_form-TOTAL_FORMS').value++;
            });
        });
    </script>
{% endblock %}